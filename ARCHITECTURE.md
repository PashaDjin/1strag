# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ 1strag

> **–í–µ—Ä—Å–∏—è:** 3.0 | **–î–∞—Ç–∞:** 23 —è–Ω–≤–∞—Ä—è 2026 | **–°—Ç–∞—Ç—É—Å:** Production-ready MVP

---

## 1. –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

**1strag** ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π RAG-—á–∞—Ç–±–æ—Ç –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ PDF-–∫–Ω–∏–≥–∞–º –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   PDF –∫–Ω–∏–≥–∏ ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  rag_setup   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ FAISS Index ‚îÇ
‚îÇ  (books/)   ‚îÇ     ‚îÇ  (Docling +  ‚îÇ     ‚îÇ (rag_index/)‚îÇ
‚îÇ             ‚îÇ     ‚îÇ HybridChunker‚îÇ     ‚îÇ             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                ‚îÇ
                                                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   app.py     ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Ollama    ‚îÇ
‚îÇ (Streamlit) ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  (RAG Chat)  ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ (qwen2.5)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ü–æ—á–µ–º—É –≤—ã–±—Ä–∞–Ω–æ |
|-----------|------------|----------------|
| **PDF Parser** | Docling | –ü–æ–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É: —Ç–∞–±–ª–∏—Ü—ã, –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–ø–∏—Å–∫–∏ |
| **Chunking** | HybridChunker | Token-aware, –Ω–µ —Ä–≤—ë—Ç —Ç–∞–±–ª–∏—Ü—ã, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç headings |
| **Embeddings** | intfloat/multilingual-e5-base | –õ—É—á—à–∏–π –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ, 512 —Ç–æ–∫–µ–Ω–æ–≤ –ª–∏–º–∏—Ç |
| **Vector Store** | FAISS | –ë—ã—Å—Ç—Ä—ã–π, –ª–æ–∫–∞–ª—å–Ω—ã–π, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| **LLM** | Ollama + qwen2.5:14b | –õ—É—á—à–∏–π –æ—Ç–∫—Ä—ã—Ç—ã–π –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ |
| **UI** | Streamlit | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥, –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø |

---

## 3. Pipeline –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

```python
# rag_setup.py ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞: rebuild_full_index()

PDF —Ñ–∞–π–ª
    ‚îÇ
    ‚ñº
DocumentConverter (Docling)
    ‚îÇ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ .docling_cache/*.json
    ‚ñº
DoclingDocument (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
    ‚îÇ
    ‚ñº
HybridChunker(max_tokens=500, merge_peers=True)
    ‚îÇ MarkdownTableSerializerProvider ‚Äî —Ç–∞–±–ª–∏—Ü—ã –≤ Markdown
    ‚îÇ contextualize() ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç headings –≤ —Ç–µ–∫—Å—Ç
    ‚ñº
List[Document] —Å metadata: {source, section, headings}
    ‚îÇ
    ‚ñº
E5Embeddings (passage: prefix)
    ‚îÇ
    ‚ñº
FAISS.from_documents()
    ‚îÇ
    ‚ñº
rag_index/
‚îú‚îÄ‚îÄ index.faiss
‚îú‚îÄ‚îÄ index.pkl
‚îî‚îÄ‚îÄ config.json
```

### –ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|----------|----------|-------------|
| `max_tokens` | 500 | E5-base –ª–∏–º–∏—Ç 512, –æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø–∞—Å |
| `merge_peers` | True | –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –º–µ–ª–∫–∏–µ —Å–æ—Å–µ–¥–Ω–∏–µ —á–∞–Ω–∫–∏ |
| `TOP_K` | 20 | –ë–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ |

---

## 4. Pipeline –æ—Ç–≤–µ—Ç–∞

```python
# app.py ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞: ask_question()

–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    ‚îÇ
    ‚ñº
retriever.invoke(question)  # E5 –¥–æ–±–∞–≤–ª—è–µ—Ç "query:" prefix
    ‚îÇ
    ‚ñº
TOP_K –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (20 —á–∞–Ω–∫–æ–≤)
    ‚îÇ
    ‚ñº
format_context(docs)
    ‚îÇ –ü–æ—Ä—è–¥–æ–∫: –º–µ–Ω–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ ‚Üí –±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ
    ‚îÇ "Recency bias" ‚Äî LLM –ª—É—á—à–µ –ø–æ–º–Ω–∏—Ç –∫–æ–Ω–µ—Ü
    ‚ñº
build_prompt(context, question)
    ‚îÇ SYSTEM_PROMPT + –∫–æ–Ω—Ç–µ–∫—Å—Ç + –≤–æ–ø—Ä–æ—Å
    ‚ñº
llm.invoke(prompt)  # qwen2.5:14b
    ‚îÇ
    ‚ñº
–û—Ç–≤–µ—Ç + format_sources(docs)
```

---

## 5. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
1strag/
‚îú‚îÄ‚îÄ app.py              # 402 —Å—Ç—Ä–æ–∫–∏ ‚Äî Streamlit UI + RAG pipeline
‚îú‚îÄ‚îÄ rag_setup.py        # 327 —Å—Ç—Ä–æ–∫ ‚Äî –°–±–æ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–∞
‚îú‚îÄ‚îÄ requirements.txt    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ README.md           # Quick start
‚îú‚îÄ‚îÄ ARCHITECTURE.md     # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ AntiOverengineering_RULES.md
‚îÇ
‚îú‚îÄ‚îÄ books/              # PDF –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ *.pdf
‚îÇ
‚îú‚îÄ‚îÄ rag_index/          # FAISS –∏–Ω–¥–µ–∫—Å (gitignore)
‚îÇ   ‚îú‚îÄ‚îÄ index.faiss
‚îÇ   ‚îú‚îÄ‚îÄ index.pkl
‚îÇ   ‚îî‚îÄ‚îÄ config.json
‚îÇ
‚îî‚îÄ‚îÄ .docling_cache/     # –ö–µ—à Docling (gitignore)
    ‚îî‚îÄ‚îÄ *.json
```

---

## 6. –ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏

### rag_setup.py

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|
| `MarkdownTableSerializerProvider` | –¢–∞–±–ª–∏—Ü—ã –≤ Markdown (–Ω–µ Key=Value) |
| `E5Embeddings` | Wrapper —Å passage:/query: –ø—Ä–µ—Ñ–∏–∫—Å–∞–º–∏ |
| `load_docling_document()` | –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è PDF —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º |
| `chunk_with_hybrid_chunker()` | –ß–∞–Ω–∫–∏–Ω–≥ —á–µ—Ä–µ–∑ Docling HybridChunker |
| `rebuild_full_index()` | –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–±–æ—Ä–∫–∏ |

### app.py

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|
| `SYSTEM_PROMPT` | –ü—Ä–æ–º–ø—Ç –¥–ª—è LLM (~220 —Ç–æ–∫–µ–Ω–æ–≤) |
| `E5QueryEmbeddings` | Wrapper –¥–ª—è query: prefix –ø—Ä–∏ –ø–æ–∏—Å–∫–µ |
| `format_context()` | –°–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π |
| `ask_question()` | –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è RAG |
| `main()` | Streamlit UI |

---

## 7. –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç

```
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç, –≥–æ—Ç–æ–≤—è—â–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª –¥–ª—è –æ–±—É—á–∞—é—â–µ–≥–æ –∫—É—Ä—Å–∞.

–Ø–ó–´–ö: –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.

–ì–õ–ê–í–ù–û–ï –ü–†–ê–í–ò–õ–û: –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∏–∂–µ.

–¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –û–¢–í–ï–¢–£:
1. –ú–∏–Ω–∏–º—É–º 3-5 –∞–±–∑–∞—Ü–µ–≤ ‚Äî –∫—Ä–∞—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã
2. –ü–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º –º—ã—Å–ª–µ–Ω–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –í–°–ï —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ‚Üí –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ ‚Üí –ø—Ä–∏–º–µ—Ä—ã ‚Üí –∏—Ç–æ–≥
4. –†–∞—Å–∫—Ä–æ–π –∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç: —á—Ç–æ —ç—Ç–æ, –∑–∞—á–µ–º –Ω—É–∂–Ω–æ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
5. –ü—Ä–∏–≤–æ–¥–∏ —Ü–∏—Ç–∞—Ç—ã –∏ —Ñ–æ—Ä–º—É–ª—ã –¥–æ—Å–ª–æ–≤–Ω–æ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
6. –ï—Å–ª–∏ –µ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è ‚Äî –æ–±—ä—è—Å–Ω–∏ —Å–≤—è–∑—å –º–µ–∂–¥—É –Ω–∏–º–∏
7. –ü–∏—à–∏ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º, –∫–∞–∫ –¥–ª—è –Ω–µ—Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞

–§–û–†–ú–ê–¢:
- –¢–µ—Ä–º–∏–Ω—ã –≤—ã–¥–µ–ª—è–π **–∂–∏—Ä–Ω—ã–º**
- –î–ª—è –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π –Ω—É–º–µ—Ä–∞—Ü–∏—é
```

---

## 8. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | Default | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|---------|----------|
| `MAX_TOKENS` | 500 | –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ (—Ç–æ–∫–µ–Ω—ã) |
| `TOP_K` | 20 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞–Ω–∫–æ–≤ –¥–ª—è retrieval |
| `EMBED_MODEL` | intfloat/multilingual-e5-base | –ú–æ–¥–µ–ª—å embeddings |
| `OLLAMA_MODEL` | qwen2.5:14b | –ú–æ–¥–µ–ª—å LLM |
| `OLLAMA_BASE_URL` | http://localhost:11434 | URL Ollama |
| `BOOKS_DIR` | books/ | –ü–∞–ø–∫–∞ —Å PDF |
| `INDEX_DIR` | rag_index/ | –ü–∞–ø–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ |

---

## 9. –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **E5 –ª–∏–º–∏—Ç 512 —Ç–æ–∫–µ–Ω–æ–≤** ‚Äî —á–∞–Ω–∫–∏ > 500 —Ç–æ–∫–µ–Ω–æ–≤ –æ–±—Ä–µ–∑–∞—é—Ç—Å—è
2. **Qwen –∏–Ω–æ–≥–¥–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –∫–∏—Ç–∞–π—Å–∫–∏–π** ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ —è–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ —è–∑—ã–∫–∞
3. **FAISS pickle** ‚Äî `allow_dangerous_deserialization=True` —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–µ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
4. **–ù–µ—Ç GPU –≤ Codespaces** ‚Äî embeddings –Ω–∞ CPU (~30 —Å–µ–∫ –Ω–∞ –∫–Ω–∏–≥—É)

---

## 10. –†–∞–∑–≤–∏—Ç–∏–µ (TODO)

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å reranking (CrossEncoder) –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- [ ] Streaming –æ—Ç–≤–µ—Ç–æ–≤ (—Å–µ–π—á–∞—Å –∂–¥—ë–º –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç)
- [ ] –ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å (–≥—Ä–∞—Ñ–∏–∫–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ PDF)

### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- Parent-child chunking (–ø–æ–∏—Å–∫ –ø–æ –º–µ–ª–∫–∏–º, –æ—Ç–≤–µ—Ç –ø–æ –∫—Ä—É–ø–Ω—ã–º)
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ embeddings –º–µ–∂–¥—É —Å–±–æ—Ä–∫–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ EPUB, DOCX

---

## 11. –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–°–º. [AntiOverengineering_RULES.md](AntiOverengineering_RULES.md)

- **KISS** ‚Äî Keep It Simple, Stupid
- **YAGNI** ‚Äî You Aren't Gonna Need It  
- **–§—É–Ω–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–æ –∫–ª–∞—Å—Å–æ–≤** (–∫—Ä–æ–º–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö wrapper'–æ–≤)
- **–ù–∏–∫–∞–∫–∏—Ö –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π "–Ω–∞ –±—É–¥—É—â–µ–µ"**
