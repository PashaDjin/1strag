# üìã –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞: RAG-—á–∞—Ç–±–æ—Ç –ø–æ —Ä—É—Å—Å–∫–∏–º PDF

---

## 1. –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**–ù–∞–∑–≤–∞–Ω–∏–µ:** 1strag (First RAG)

**–°—É—Ç—å:** –õ–æ–∫–∞–ª—å–Ω—ã–π —á–∞—Ç–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É PDF-—Ñ–∞–π–ª–æ–≤ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –ø–æ–∫–∞–∑—ã–≤–∞—è –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (—Ñ–∞–π–ª + —Å—Ç—Ä–∞–Ω–∏—Ü–∞).

**–°—Ç–µ–∫:**
- Python 3.11+
- Streamlit (UI)
- LangChain (RAG pipeline)
- FAISS (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫)
- Ollama (–ª–æ–∫–∞–ª—å–Ω–∞—è LLM)
- HuggingFace Embeddings (–º—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ)

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–æ–¥–∏–Ω –ø–æ—Ç–æ–∫)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         –°–ë–û–†–ö–ê –ò–ù–î–ï–ö–°–ê                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  books/*.pdf                                                    ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  PyPDFLoader(mode="page")                                       ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  [Document(text, metadata={source, page}), ...]                 ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  RecursiveCharacterTextSplitter(CHUNK_SIZE, CHUNK_OVERLAP)      ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  chunks[] ‚îÄ‚îÄ‚ñ∫ chunks.jsonl (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, DEBUG_DUMP_CHUNKS=1)   ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  HuggingFaceEmbeddings(multilingual)                            ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  FAISS.from_documents() ‚îÄ‚îÄ‚ñ∫ rag_index/                          ‚îÇ
‚îÇ                              ‚îú‚îÄ‚îÄ index.faiss                    ‚îÇ
‚îÇ                              ‚îú‚îÄ‚îÄ index.pkl                      ‚îÇ
‚îÇ                              ‚îî‚îÄ‚îÄ config.json (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–±–æ—Ä–∫–∏) ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         –†–ê–ë–û–¢–ê –ß–ê–¢–ê                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –≤–æ–ø—Ä–æ—Å                                     ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  FAISS.load_local("rag_index")                                  ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  retriever = vectorstore.as_retriever(search_kwargs={"k": TOP_K})‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  docs = retriever.invoke(full_question)                         ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  –ï—Å–ª–∏ docs –ø—É—Å—Ç–æ–π ‚Üí "–Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏" (–ë–ï–ó LLM)            ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  –°–æ–±—Ä–∞—Ç—å –ø—Ä–æ–º–ø—Ç (context + question) ‚Üí Ollama LLM            ‚îÇ
‚îÇ       ‚îÇ                                                         ‚îÇ
‚îÇ       ‚ñº                                                         ‚îÇ
‚îÇ  –û—Ç–≤–µ—Ç + Sources (—Ñ–∞–π–ª.pdf [—Å—Ç—Ä. N])                            ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2.1 –ü–æ—á–µ–º—É –Ω–µ RetrievalQA chain?

–í–º–µ—Å—Ç–æ `RetrievalQA.from_chain_type()` –º—ã –≤—ã–∑—ã–≤–∞–µ–º retriever –∏ LLM –Ω–∞–ø—Ä—è–º—É—é:
- –ú–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `docs` –î–û –≤—ã–∑–æ–≤–∞ LLM (—ç–∫–æ–Ω–æ–º–∏–º –≤—Ä–µ–º—è –µ—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ–º–ø—Ç–æ–º
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å `query` vs `question` –∫–ª—é—á–∞–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö LangChain

---

## 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
1strag/
‚îú‚îÄ‚îÄ app.py                  # Streamlit UI + retriever + llm –Ω–∞–ø—Ä—è–º—É—é
‚îú‚îÄ‚îÄ rag_setup.py            # –§—É–Ω–∫—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ –∏–Ω–¥–µ–∫—Å–∞
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ README.md               # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ AntiOverengineering_RULES.md  # –ü—Ä–∞–≤–∏–ª–∞
‚îú‚îÄ‚îÄ TECHNICAL_SPEC.md       # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ .gitignore              # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è git
‚îÇ
‚îú‚îÄ‚îÄ books/                  # PDF –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ .gitkeep            # –ß—Ç–æ–±—ã –ø–∞–ø–∫–∞ –±—ã–ª–∞ –≤ git
‚îÇ
‚îú‚îÄ‚îÄ rag_index/              # FAISS –∏–Ω–¥–µ–∫—Å (—Å–æ–∑–¥–∞—ë—Ç—Å—è, –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
‚îÇ   ‚îú‚îÄ‚îÄ index.faiss
‚îÇ   ‚îú‚îÄ‚îÄ index.pkl
‚îÇ   ‚îî‚îÄ‚îÄ config.json         # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–±–æ—Ä–∫–∏ (chunk_size, overlap, model)
‚îÇ
‚îî‚îÄ‚îÄ chunks.jsonl            # –î–∞–º–ø —á–∞–Ω–∫–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, DEBUG_DUMP_CHUNKS=1)
```

**–ò—Ç–æ–≥–æ: 7 —Ñ–∞–π–ª–æ–≤ –∫–æ–¥–∞/–∫–æ–Ω—Ñ–∏–≥–∞ + 2 –ø–∞–ø–∫–∏**

---

## 4. –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–π

### 4.1 `rag_setup.py`

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞: –∑–∞–≥—Ä—É–∑–∫—É PDF, —á–∞–Ω–∫–∏–Ω–≥, —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞.

```
–§–£–ù–ö–¶–ò–ò:

get_pdf_files(books_dir: str) -> list[str]
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø—É—Ç–µ–π –∫ PDF –≤ –ø–∞–ø–∫–µ books/

load_documents(pdf_paths: list[str]) -> list[Document]
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç PDF –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ —á–µ—Ä–µ–∑ PyPDFLoader(mode="page")
    –ö–∞–∂–¥—ã–π Document —Å–æ–¥–µ—Ä–∂–∏—Ç metadata: {source: "books/file.pdf", page: 0}
    –í–ê–ñ–ù–û: source —Å–æ–¥–µ—Ä–∂–∏—Ç –ü–£–¢–¨, –Ω–µ –∏–º—è —Ñ–∞–π–ª–∞. –í UI –ø—Ä–∏–≤–æ–¥–∏–º –∫ basename.

split_documents(docs: list[Document], chunk_size: int, chunk_overlap: int) -> list[Document]
    –†–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ —á–∞–Ω–∫–∏ —á–µ—Ä–µ–∑ RecursiveCharacterTextSplitter
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç metadata –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞

save_chunks_for_debug(chunks: list[Document], path: str)
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–∞–Ω–∫–∏ –≤ JSONL –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ DEBUG_DUMP_CHUNKS=1)
    –§–æ—Ä–º–∞—Ç: {"text": "...", "source": "file.pdf", "page": 5, "chunk_id": 0}

save_index_config(index_dir: str, chunk_size: int, chunk_overlap: int, embed_model: str, pdf_files: list[str], chunk_count: int)
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç config.json —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å–±–æ—Ä–∫–∏ –∏–Ω–¥–µ–∫—Å–∞:
    - chunk_size, chunk_overlap, embed_model
    - built_at (ISO datetime —Å–±–æ—Ä–∫–∏)
    - pdf_count (–∫–æ–ª-–≤–æ PDF)
    - pdf_files (—Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω —Ñ–∞–π–ª–æ–≤)
    - chunk_count (–∫–æ–ª-–≤–æ —á–∞–Ω–∫–æ–≤)

build_index(chunks: list[Document], index_dir: str, embed_model: str)
    –°–æ–∑–¥–∞—ë—Ç embeddings –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç FAISS –∏–Ω–¥–µ–∫—Å
    –í–ê–ñ–ù–û: HuggingFaceEmbeddings –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ langchain_huggingface

rebuild_full_index(books_dir: str, index_dir: str) -> bool
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è: –≤—ã–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ
    –ß–∏—Ç–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ env (CHUNK_SIZE, CHUNK_OVERLAP)
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ, False –µ—Å–ª–∏ –Ω–µ—Ç PDF
```

### 4.2 `app.py`

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞: UI, –∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–∞, —á–∞—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π.

```
–§–£–ù–ö–¶–ò–ò:

load_index(index_dir: str, config: dict) -> FAISS | None
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç FAISS –∏–Ω–¥–µ–∫—Å —Å –¥–∏—Å–∫–∞.
    –í–ê–ñ–ù–û: Embeddings —Å–æ–∑–¥–∞—é—Ç—Å—è –ó–î–ï–°–¨ –û–î–ò–ù –†–ê–ó –∏–∑ config["embed_model"].
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç @st.cache_resource –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞ –ò embeddings.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç None –µ—Å–ª–∏ –∏–Ω–¥–µ–∫—Å–∞ –Ω–µ—Ç.

load_index_config(index_dir: str) -> dict | None
    –ó–∞–≥—Ä—É–∂–∞–µ—Ç config.json —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å–±–æ—Ä–∫–∏.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: {
        "chunk_size": int, "chunk_overlap": int, "embed_model": str,
        "built_at": str, "pdf_count": int, "pdf_files": list, "chunk_count": int
    }
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç None –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç.

get_embeddings(config: dict) -> HuggingFaceEmbeddings
    –°–æ–∑–¥–∞—ë—Ç embeddings –∏—Å–ø–æ–ª—å–∑—É—è embed_model –ò–ó CONFIG (–Ω–µ –∏–∑ env!).
    –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ò–ó load_index(), –Ω–µ –∏–∑ ask_question().
    –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∏ –ø—Ä–∏ query.

check_embed_model_mismatch(config: dict) -> bool
    –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç config["embed_model"] —Å os.getenv("EMBED_MODEL").
    –ï—Å–ª–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç True (–ø–æ–∫–∞–∑–∞—Ç—å warning).

get_llm() -> OllamaLLM
    –°–æ–∑–¥–∞—ë—Ç LLM –∏–∑ Ollama
    –ú–æ–¥–µ–ª—å –±–µ—Ä—ë—Ç—Å—è –∏–∑ os.getenv("OLLAMA_MODEL", "llama3")

check_ollama_connection(llm: OllamaLLM) -> bool
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Ollama –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º.
    try:
        llm.invoke("test")
        return True
    except:
        return False
    
    –í main() –µ—Å–ª–∏ False:
        st.error("‚ùå Ollama –Ω–µ –¥–æ—Å—Ç—É–ø–Ω–∞. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: ollama serve")
        st.stop()

build_history_text(messages: list[dict], max_pairs: int = 3) -> str
    –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç UI-–∏—Å—Ç–æ—Ä–∏—é –≤ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞.
    –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞:
        "–í–æ–ø—Ä–æ—Å: ...
        –û—Ç–≤–µ—Ç: ...
        
        –í–æ–ø—Ä–æ—Å: ...
        –û—Ç–≤–µ—Ç: ..."
    –ë–µ—Ä—ë—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ max_pairs –ø–∞—Ä (user, assistant).
    –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É.

get_retriever(vectorstore: FAISS, top_k: int) -> VectorStoreRetriever
    –°–æ–∑–¥–∞—ë—Ç retriever —Å –∑–∞–¥–∞–Ω–Ω—ã–º k:
    return vectorstore.as_retriever(search_kwargs={"k": top_k})
    
    –í–ê–ñ–ù–û: k –∑–∞–¥–∞—ë—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ retriever, –ù–ï –ø—Ä–∏ –≤—ã–∑–æ–≤–µ.

ask_question(retriever, llm, question: str, messages: list[dict]) -> tuple[str, list[Document]]
    1. history_text = build_history_text(messages)
    2. full_question = f"–ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–∏–∞–ª–æ–≥:\n{history_text}\n\n–¢–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å: {question}"
       (–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ question –µ—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞)
    3. docs = retriever.invoke(full_question)  # –û–°–ù–û–í–ù–û–ô –º–µ—Ç–æ–¥
       –û–∂–∏–¥–∞–µ–º: list[Document].
       Fallback: get_relevant_documents() –¢–û–õ–¨–ö–û –µ—Å–ª–∏ invoke –≤–µ—Ä–Ω—É–ª –Ω–µ list.
    4. –ï—Å–ª–∏ not docs: return "–í –∫–Ω–∏–≥–∞—Ö –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...", []  # –ë–ï–ó –≤—ã–∑–æ–≤–∞ LLM
    5. –°–æ–±—Ä–∞—Ç—å context:
       context = "\n\n---\n\n".join(doc.page_content for doc in docs)
    6. –°–æ–±—Ä–∞—Ç—å prompt = SYSTEM_PROMPT.format(context=context, question=full_question)
    7. answer = llm.invoke(prompt)
    8. return (answer, docs)
    
    –í–ê–ñ–ù–û: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º RetrievalQA chain. –ù–µ —Å–æ–∑–¥–∞—ë–º embeddings –∑–¥–µ—Å—å.

format_source(doc: Document) -> str
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –≤ –ï–î–ò–ù–´–ô —Ñ–æ—Ä–º–∞—Ç: "book.pdf [—Å—Ç—Ä. 23]"
    1. filename = os.path.basename(doc.metadata.get("source", "unknown"))
    2. page = doc.metadata.get("page_label") –∏–ª–∏ str(doc.metadata.get("page", 0) + 1)
    3. return f"{filename} [—Å—Ç—Ä. {page}]"

format_sources(source_documents: list[Document]) -> list[str]
    –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏ –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

main()
    Streamlit UI:
    - –ó–∞–≥–æ–ª–æ–≤–æ–∫
    - Sidebar —Å –∫–Ω–æ–ø–∫–∞–º–∏ Clear chat / Rebuild index + —Å—Ç–∞—Ç—É—Å –∏–Ω–¥–µ–∫—Å–∞
    - –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (st.session_state.messages)
    - –ü–æ–ª–µ –≤–≤–æ–¥–∞
    - –í—ã–≤–æ–¥ –æ—Ç–≤–µ—Ç–∞ + –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    
    –í–ê–ñ–ù–û: –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è Rebuild index:
    1. success = rebuild_full_index()
    2. –ï—Å–ª–∏ success:
       - st.cache_resource.clear()
       - st.rerun()
    3. –ï—Å–ª–∏ –Ω–µ success (–Ω–µ—Ç PDF):
       - –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –ù–ï –¥–µ–ª–∞–µ–º rerun
```

### 4.3 `requirements.txt`

```
streamlit
langchain
langchain-community
langchain-ollama
langchain-huggingface
faiss-cpu
pypdf
sentence-transformers
```

### 4.4 `.gitignore`

```
rag_index/
chunks.jsonl
*.pyc
__pycache__/
.env
.venv/
.streamlit/
.DS_Store
```

**‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï:** `chunks.jsonl` –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–Ω–∏–≥. –ù–µ –∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –Ω–µ –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å ‚Äî —Ä–∏—Å–∫ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∫–æ–ø–∏—Ä–∞–π—Ç–∞.

---

## 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Env –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è | Default | –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
|----------|----------------|---------|------------------|
| –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞ | `CHUNK_SIZE` | 1000 | rag_setup.py |
| –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ —á–∞–Ω–∫–æ–≤ | `CHUNK_OVERLAP` | 200 | rag_setup.py |
| –ö–æ–ª-–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | `TOP_K` | 4 | app.py |
| –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ | `EMBED_MODEL` | `sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2` | rag_setup.py (–ø—Ä–∏ —Å–±–æ—Ä–∫–µ) |
| –ú–æ–¥–µ–ª—å Ollama | `OLLAMA_MODEL` | `llama3` | app.py |
| –î–∞–º–ø —á–∞–Ω–∫–æ–≤ | `DEBUG_DUMP_CHUNKS` | `0` | rag_setup.py |
| –ü–∞–ø–∫–∞ —Å PDF | `BOOKS_DIR` | `books/` | –æ–±–∞ —Ñ–∞–π–ª–∞ |
| –ü–∞–ø–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ | `INDEX_DIR` | `rag_index/` | –æ–±–∞ —Ñ–∞–π–ª–∞ |

**–ö–†–ò–¢–ò–ß–ù–û:** –ü—Ä–∏ —Å–±–æ—Ä–∫–µ –∏–Ω–¥–µ–∫—Å–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `{INDEX_DIR}/config.json`. 

**–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω–¥–µ–∫—Å–∞ –≤ app.py:**
- –ß–∏—Ç–∞–µ–º `embed_model` –∏–∑ `{INDEX_DIR}/config.json` (–ù–ï –∏–∑ env!)
- –ò—Å–ø–æ–ª—å–∑—É–µ–º —ç—Ç—É –º–æ–¥–µ–ª—å –¥–ª—è `HuggingFaceEmbeddings` –ø—Ä–∏ `FAISS.load_local()`
- –ï—Å–ª–∏ env `EMBED_MODEL` –∑–∞–¥–∞–Ω –∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `config.json` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º warning

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ embeddings –ø—Ä–∏ query —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å embeddings –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∏–Ω–¥–µ–∫—Å–∞.

---

## 6. –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–∞)

**–í–ê–ñ–ù–û:** –ú—ã –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º RetrievalQA chain. –ü—Ä–æ–º–ø—Ç —Å–æ–±–∏—Ä–∞–µ–º –∫–∞–∫ f-string –≤ ask_question().
–ò—Å—Ç–æ—Ä–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `full_question`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ {question}.

```
–¢—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫, –æ—Ç–≤–µ—á–∞—é—â–∏–π –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–∑ –∫–Ω–∏–≥.

–ü–†–ê–í–ò–õ–ê:
1. –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–∏–∂–µ.
2. –ï—Å–ª–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ù–ï–¢ –æ—Ç–≤–µ—Ç–∞ ‚Äî –æ—Ç–≤–µ—á–∞–π: "–í –∫–Ω–∏–≥–∞—Ö –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É."
3. –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π —Ñ–∞–∫—Ç—ã. –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –≤–Ω–µ—à–Ω–∏–µ –∑–Ω–∞–Ω–∏—è.
4. –ù–ï –¥–æ–±–∞–≤–ª—è–π –∏—Å—Ç–æ—á–Ω–∏–∫–∏/—Å—Å—ã–ª–∫–∏/—Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –æ—Ç–¥–µ–ª—å–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
5. –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤.

–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –∫–Ω–∏–≥:
{context}

–í–æ–ø—Ä–æ—Å: {question}

–û—Ç–≤–µ—Ç:
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—è:** –í `ask_question()` —Ñ–æ—Ä–º–∏—Ä—É–µ–º `full_question`:
```
–ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–∏–∞–ª–æ–≥:
–í–æ–ø—Ä–æ—Å: ...
–û—Ç–≤–µ—Ç: ...

–¢–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å: <user_question>
```
–≠—Ç–æ—Ç `full_question` –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ `{question}` –≤ –ø—Ä–æ–º–ø—Ç–µ.

### –ó–∞—â–∏—Ç–∞ –æ—Ç –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–π (–≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ ask_question):

```python
# –°–ù–ê–ß–ê–õ–ê retrieval, –ü–û–¢–û–ú –ø—Ä–æ–≤–µ—Ä–∫–∞:
docs = retriever.invoke(full_question)
if not docs:
    return "–í –∫–Ω–∏–≥–∞—Ö –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É.", []
# LLM –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –µ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã
```

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:** –ï—Å–ª–∏ retriever –≤–µ—Ä–Ω—É–ª —á–∞–Ω–∫–∏, –Ω–æ –æ–Ω–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –æ—Ç–≤–µ—Ç–∞ ‚Äî –º–æ–¥–µ–ª—å –æ–±—è–∑–∞–Ω–∞ —Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—É –∏ —Å–∫–∞–∑–∞—Ç—å "–Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏", –∞ –Ω–µ —Ñ–∞–Ω—Ç–∞–∑–∏—Ä–æ–≤–∞—Ç—å. –≠—Ç–æ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 100%, –Ω–æ –ø—Ä–æ–º–ø—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∂—ë—Å—Ç–∫–∏–π.

---

## 7. UI (Streamlit)

### –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üìö RAG —á–∞—Ç–±–æ—Ç –ø–æ PDF                                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                          ‚îÇ
‚îÇ  [–°–∏–¥–µ–±–∞—Ä]              ‚îÇ  üí¨ –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞               ‚îÇ
‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ             ‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ             ‚îÇ
‚îÇ  üóëÔ∏è Clear chat          ‚îÇ  User: –ö—Ç–æ –∞–≤—Ç–æ—Ä –∫–Ω–∏–≥–∏?        ‚îÇ
‚îÇ  üîÑ Rebuild index       ‚îÇ  Bot: –î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π...           ‚îÇ
‚îÇ                         ‚îÇ       Sources:                 ‚îÇ
‚îÇ  üìä –°—Ç–∞—Ç—É—Å:             ‚îÇ       ‚Ä¢ book.pdf [—Å—Ç—Ä. 1]      ‚îÇ
‚îÇ  –ò–Ω–¥–µ–∫—Å –∑–∞–≥—Ä—É–∂–µ–Ω ‚úÖ     ‚îÇ                                ‚îÇ
‚îÇ  PDF: 3                 ‚îÇ  User: –ö–æ–≥–¥–∞ –æ–Ω —Ä–æ–¥–∏–ª—Å—è?       ‚îÇ
‚îÇ  –ß–∞–Ω–∫–æ–≤: 234            ‚îÇ  Bot: –í 1821 –≥–æ–¥—É...           ‚îÇ
‚îÇ  chunk_size: 1000       ‚îÇ       Sources:                 ‚îÇ
‚îÇ  overlap: 200           ‚îÇ       ‚Ä¢ book.pdf [—Å—Ç—Ä. 5]      ‚îÇ
‚îÇ                         ‚îÇ                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  [–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –ø–æ –∫–Ω–∏–≥–∞–º...]                    [Send] ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°–æ—Å—Ç–æ—è–Ω–∏—è:
1. **–ù–µ—Ç –∏–Ω–¥–µ–∫—Å–∞** ‚Üí "–ò–Ω–¥–µ–∫—Å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ª–æ–∂–∏—Ç–µ PDF –≤ books/ –∏ –Ω–∞–∂–º–∏—Ç–µ Rebuild index"
2. **–ù–µ—Ç PDF** ‚Üí "–ü–∞–ø–∫–∞ books/ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ PDF —Ñ–∞–π–ª—ã."
3. **–ò–Ω–¥–µ–∫—Å –µ—Å—Ç—å** ‚Üí –ß–∞—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤ sidebar –ø–æ–∫–∞–∑–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–±–æ—Ä–∫–∏

---

## 8. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –í–ù–ï –∫–æ–¥–∞

### 8.1 –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ollama (–æ–¥–∏–Ω —Ä–∞–∑)

```bash
# –í Codespaces –∏–ª–∏ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:
curl -fsSL https://ollama.com/install.sh | sh

# –°–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å (–≤—ã–±–µ—Ä–∏ –æ–¥–Ω—É):
ollama pull llama3          # ~4GB, —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
ollama pull llama3:8b       # —Ç–æ –∂–µ
ollama pull mistral         # ~4GB, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞
ollama pull phi3            # ~2GB, –ª–µ–≥—á–µ –¥–ª—è —Å–ª–∞–±—ã—Ö –º–∞—à–∏–Ω
```

**–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –Ω—É–∂–Ω–∞.** Ollama –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–∞—è.

### 8.2 –ü–æ–ª–æ–∂–∏—Ç—å PDF –≤ books/

–ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã. –ù–∏–∫–∞–∫–∏—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π.

### 8.3 (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ú–æ–¥–µ–ª—å Ollama
export OLLAMA_MODEL=mistral

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —á–∞–Ω–∫–∏–Ω–≥–∞ (—Ç—Ä–µ–±—É–µ—Ç Rebuild –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)
export CHUNK_SIZE=1000
export CHUNK_OVERLAP=200

# –ö–æ–ª-–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ retrieval
export TOP_K=4

# –í–∫–ª—é—á–∏—Ç—å –¥–∞–º–ø —á–∞–Ω–∫–æ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
export DEBUG_DUMP_CHUNKS=1
```

---

## 9. Roadmap —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** ~5-7 —á–∞—Å–æ–≤ (–ø–æ–ª–¥–Ω—è –Ω–∞ –ø–µ—Ä–≤—ã–π —Ä–∞–±–æ—á–∏–π –≤–∞—Ä–∏–∞–Ω—Ç)

### –≠—Ç–∞–ø 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (15 –º–∏–Ω)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `AntiOverengineering_RULES.md`
- [ ] –°–æ–∑–¥–∞—Ç—å `.gitignore`
- [ ] –°–æ–∑–¥–∞—Ç—å `books/.gitkeep`
- [ ] –°–æ–∑–¥–∞—Ç—å `requirements.txt`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `README.md`

### –≠—Ç–∞–ø 2: –°–±–æ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–∞ (1.5-2 —á–∞—Å–∞)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å `rag_setup.py`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ config.json
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 1 PDF
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `chunks.jsonl` —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ DEBUG_DUMP_CHUNKS=1

### –≠—Ç–∞–ø 3: –ß–∞—Ç UI (2-3 —á–∞—Å–∞)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å `app.py`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å retriever + llm —Å –∂—ë—Å—Ç–∫–∏–º –ø—Ä–æ–º–ø—Ç–æ–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ä—É—á–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –≤ –ø—Ä–æ–º–ø—Ç (build_history_text)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ sidebar + –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ config
- [ ] –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (basename + page_label)

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 —á–∞—Å–∞)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ / –Ω–µ—Ç PDF / –≤—Å—ë –æ–∫)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å citations (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã?)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é (–ø–æ–Ω–∏–º–∞–µ—Ç "–æ–Ω", "—ç—Ç–æ—Ç" –∏ —Ç.–¥.?)
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å "–Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ –≤ –∫–Ω–∏–≥–∞—Ö" (DoD #5)

### –≠—Ç–∞–ø 5: –û—Ç–ª–∞–¥–∫–∞ —á–∞–Ω–∫–æ–≤ (–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- [ ] –¢—ã —Ç–µ—Å—Ç–∏—Ä—É–µ—à—å, –¥–∞—ë—à—å —Ñ–∏–¥–±–µ–∫
- [ ] –í–∫–ª—é—á–∞–µ–º DEBUG_DUMP_CHUNKS=1, —Å–º–æ—Ç—Ä–∏–º `chunks.jsonl`
- [ ] –ü—Ä–∞–≤–∏–º CHUNK_SIZE/CHUNK_OVERLAP —á–µ—Ä–µ–∑ env
- [ ] Rebuild

---

## 10. Definition of Done (–∫–æ–≥–¥–∞ —Å—á–∏—Ç–∞–µ–º –≥–æ—Ç–æ–≤—ã–º)

| # | –ö—Ä–∏—Ç–µ—Ä–∏–π | –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å |
|---|----------|---------------|
| 1 | –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ + –∫–Ω–æ–ø–∫–∞ Rebuild | –£–¥–∞–ª–∏—Ç—å `rag_index/`, –∑–∞–ø—É—Å—Ç–∏—Ç—å `streamlit run app.py` |
| 2 | Rebuild —Å–æ–∑–¥–∞—ë—Ç –∏–Ω–¥–µ–∫—Å + config.json | –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –≤ `rag_index/` |
| 3 | DEBUG_DUMP_CHUNKS=1 —Å–æ–∑–¥–∞—ë—Ç chunks.jsonl | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å env, Rebuild, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª |
| 4 | –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ –∫–Ω–∏–≥–µ + sources | –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É PDF |
| 5 | –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–ª–∏–∑) | –ò—Å—Ç–æ—Ä–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å; –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ—Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏ |
| 6 | –ù–∞ –≤–æ–ø—Ä–æ—Å –Ω–µ –ø–æ –∫–Ω–∏–≥–µ ‚Äî "–Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏" | –°–ø—Ä–æ—Å–∏—Ç—å —á—Ç–æ-—Ç–æ, —á–µ–≥–æ –Ω–µ—Ç –≤ PDF |
| 7 | Sources –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç basename + —Å—Ç—Ä–∞–Ω–∏—Ü—É | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç "book.pdf [—Å—Ç—Ä. 5]" |
| 8 | Sidebar –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–±–æ—Ä–∫–∏ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ chunk_size/overlap |
| 9 | –†–∞–±–æ—Ç–∞–µ—Ç –≤ Codespaces –Ω–∞ –ø–æ—Ä—Ç—É 8501 | –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ |

---

## 11. –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

| –†–∏—Å–∫ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-----------|
| Ollama –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ | README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π |
| Ollama –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞ | check_ollama_connection() + —Å–æ–æ–±—â–µ–Ω–∏–µ "ollama serve" |
| –ú–æ–¥–µ–ª—å –Ω–µ —Å–∫–∞—á–∞–Ω–∞ | –ß—ë—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ |
| PDF —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π ‚Äî –¥–æ–ª–≥–æ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è | –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ README |
| `allow_dangerous_deserialization` | –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å, –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ–º —á—É–∂–∏–µ |
| Embeddings –¥–æ–ª–≥–æ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–π —Ä–∞–∑ | –û–¥–∏–Ω —Ä–∞–∑ ~500MB, –ø–æ—Ç–æ–º –∫—ç—à |
| LLM "—Ñ–∞–Ω—Ç–∞–∑–∏—Ä—É–µ—Ç" | –ñ—ë—Å—Ç–∫–∏–π –ø—Ä–æ–º–ø—Ç + –ø—Ä–æ–≤–µ—Ä–∫–∞ docs –¥–æ LLM |
| –ò–∑–º–µ–Ω–∏–ª env –Ω–æ –∑–∞–±—ã–ª Rebuild | config.json –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ sidebar |
| Embed model –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç (build vs query) | app.py —á–∏—Ç–∞–µ—Ç –º–æ–¥–µ–ª—å –∏–∑ config.json, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç warning –µ—Å–ª–∏ env –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è |
| –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–¥—É–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–∞—Ä—ã Q&A |

---

## 12. –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è (–ø–æ—á–µ–º—É —Ç–∞–∫, –∞ –Ω–µ –∏–Ω–∞—á–µ)

| –†–µ—à–µ–Ω–∏–µ | –ü–æ—á–µ–º—É |
|---------|--------|
| retriever + llm –Ω–∞–ø—Ä—è–º—É—é (–Ω–µ RetrievalQA chain) | –ú–æ–∂–µ–º –ø—Ä–æ–≤–µ—Ä–∏—Ç—å docs –î–û LLM, –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å query/question –∫–ª—é—á–∞–º–∏ |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ docs –¥–æ LLM | –≠–∫–æ–Ω–æ–º–∏–º –≤—Ä–µ–º—è, –∏—Å–∫–ª—é—á–∞–µ–º —Ñ–∞–Ω—Ç–∞–∑–∏–∏ –Ω–∞ –ø—É—Å—Ç—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö |
| –ò—Å—Ç–æ—Ä–∏—è –≤ –ø—Ä–æ–º–ø—Ç–µ –≤—Ä—É—á–Ω—É—é | –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ, –ª–µ–≥–∫–æ –¥–µ–±–∞–∂–∏—Ç—å |
| –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ env | –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ |
| config.json –ø—Ä–∏ —Å–±–æ—Ä–∫–µ | –í–∏–¥–Ω–æ —Å –∫–∞–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å–æ–±—Ä–∞–Ω –∏–Ω–¥–µ–∫—Å |
| chunks.jsonl –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ | –ù–µ —Ç–æ—Ä–º–æ–∑–∏—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –≤–∫–ª—é—á–∞–µ—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ |
| basename –¥–ª—è sources | –ß–∏—Å—Ç—ã–π UI –±–µ–∑ –ø–æ–ª–Ω—ã—Ö –ø—É—Ç–µ–π |
| page_label —Å fallback –Ω–∞ page+1 | –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ PDF |
| Embed model –∏–∑ config.json –ø—Ä–∏ query | –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ embeddings –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∏ –ø–æ–∏—Å–∫–µ |
| st.cache_resource.clear() –ø–æ—Å–ª–µ Rebuild | –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ |
| –§–æ—Ä–º–∞—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ "—Å—Ç—Ä." –≤–µ–∑–¥–µ | –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ –≤ UI |

---

## 13. –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

1. **PDF –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** –ö–Ω–∏–≥–∞ –ø–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–º—É —É—á—ë—Ç—É (—Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç, —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∞—è —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è)
2. **Ollama:** –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ
3. **–ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:** llama3
